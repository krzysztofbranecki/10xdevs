---
import Layout from "../layouts/Layout.astro";
import PageWrapper from "../components/common/PageWrapper.astro";

// Dostęp do danych użytkownika
const { user } = Astro.locals;

// Przykładowe dane kolekcji (w przyszłości z API)
const mockCollections = [
  {
    id: 1,
    name: "Angielski podstawowy",
    description: "Podstawowe słówka do nauki języka angielskiego",
    cardCount: 42,
    lastModified: "2023-09-15",
  },
  {
    id: 2,
    name: "Hiszpański podróże",
    description: "Przydatne zwroty podczas podróży do krajów hiszpańskojęzycznych",
    cardCount: 28,
    lastModified: "2023-10-02",
  },
  {
    id: 3,
    name: "Programowanie JavaScript",
    description: "Pojęcia związane z programowaniem w JavaScript",
    cardCount: 35,
    lastModified: "2023-10-10",
  },
];

// Skrypt do obsługi kolekcji
const collectionsScript = `
  document.addEventListener("DOMContentLoaded", () => {
    const deleteButtons = document.querySelectorAll('[data-action="delete-collection"]');
    const confirmModal = document.getElementById('confirmModal');
    const cancelDeleteBtn = document.getElementById('cancelDelete');
    const confirmDeleteBtn = document.getElementById('confirmDelete');
    let collectionToDelete = null;

    // Obsługa przycisków usuwania
    deleteButtons.forEach(button => {
      button.addEventListener('click', (e) => {
        e.preventDefault();
        collectionToDelete = button.getAttribute('data-collection-id');
        confirmModal.classList.remove('hidden');
      });
    });

    // Anulowanie usuwania
    if (cancelDeleteBtn) {
      cancelDeleteBtn.addEventListener('click', () => {
        confirmModal.classList.add('hidden');
        collectionToDelete = null;
      });
    }

    // Potwierdzenie usuwania
    if (confirmDeleteBtn) {
      confirmDeleteBtn.addEventListener('click', async () => {
        if (collectionToDelete) {
          try {
            // W przyszłości: faktyczne usunięcie przez API
            console.log("Usuwanie kolekcji o ID:", collectionToDelete);
            
            // Symulacja odpowiedzi API
            setTimeout(() => {
              // Ukrywanie usuniętej kolekcji
              const collectionElement = document.querySelector(\`[data-collection-id="\${collectionToDelete}"]\`).closest('.collection-item');
              if (collectionElement) {
                collectionElement.classList.add('scale-0', 'opacity-0');
                setTimeout(() => {
                  collectionElement.remove();
                  
                  // Sprawdzanie czy istnieją jeszcze jakieś kolekcje
                  const remainingCollections = document.querySelectorAll('.collection-item');
                  if (remainingCollections.length === 0) {
                    document.getElementById('noCollections').classList.remove('hidden');
                  }
                }, 300);
              }
              
              confirmModal.classList.add('hidden');
              collectionToDelete = null;
            }, 500);
            
          } catch (error) {
            console.error("Błąd podczas usuwania kolekcji:", error);
            confirmModal.classList.add('hidden');
          }
        }
      });
    }
  });
`;
---

<Layout title="Moje kolekcje fiszek">
  <PageWrapper title="Moje kolekcje" description="Zarządzaj swoimi kolekcjami fiszek">
    <div class="flex justify-between items-center mb-6">
      <p class="text-blue-100/80">
        Zalogowano jako: <span class="text-blue-200 font-medium">{user?.email || "Gość"}</span>
      </p>
      <div class="flex space-x-3">
        <a
          href="/generate"
          class="px-3 py-1.5 bg-blue-600/80 hover:bg-blue-600 text-white rounded-lg transition-colors text-sm"
        >
          Generator fiszek
        </a>
        <form method="POST" action="/api/auth/logout">
          <button
            type="submit"
            class="px-3 py-1.5 bg-red-600/80 hover:bg-red-600 text-white rounded-lg transition-colors text-sm"
          >
            Wyloguj się
          </button>
        </form>
      </div>
    </div>

    <div class="flex justify-between items-center mb-6">
      <h2 class="text-xl font-semibold text-transparent bg-clip-text bg-gradient-to-r from-blue-200 to-purple-200">
        Twoje kolekcje
      </h2>
      <a
        href="/collections/create"
        class="px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white rounded-lg font-medium transition-all duration-300 shadow-lg hover:shadow-blue-500/20 transform hover:-translate-y-0.5 active:translate-y-0 text-sm"
      >
        Nowa kolekcja
      </a>
    </div>

    <div
      id="noCollections"
      class={`bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-lg rounded-xl p-6 border border-white/10 text-center py-10 ${mockCollections.length > 0 ? "hidden" : ""}`}
    >
      <p class="text-blue-100 mb-4">Nie masz jeszcze żadnych kolekcji fiszek.</p>
      <a
        href="/collections/create"
        class="inline-block px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white rounded-lg font-medium transition-all duration-300"
      >
        Stwórz pierwszą kolekcję
      </a>
    </div>

    <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
      {
        mockCollections.map((collection) => (
          <div class="collection-item bg-gradient-to-br from-white/10 to-white/5 backdrop-blur-lg rounded-xl p-6 border border-white/10 transition-all duration-300 hover:shadow-lg hover:shadow-blue-500/10 hover:border-white/20">
            <div class="flex justify-between items-start mb-4">
              <h3 class="font-semibold text-lg text-blue-100">{collection.name}</h3>
              <div class="flex space-x-2">
                <button
                  data-action="delete-collection"
                  data-collection-id={collection.id}
                  class="text-red-400 hover:text-red-300 p-1 rounded-md transition-colors"
                  title="Usuń kolekcję"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="w-5 h-5"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"
                    />
                  </svg>
                </button>
                <a
                  href={`/collections/edit/${collection.id}`}
                  class="text-blue-400 hover:text-blue-300 p-1 rounded-md transition-colors"
                  title="Edytuj kolekcję"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="w-5 h-5"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10"
                    />
                  </svg>
                </a>
              </div>
            </div>
            <p class="text-blue-200/80 text-sm mb-4">{collection.description}</p>
            <div class="flex justify-between items-center text-xs text-blue-300/70 mb-5">
              <span>{collection.cardCount} fiszek</span>
              <span>Ostatnia zmiana: {collection.lastModified}</span>
            </div>
            <div class="mt-5 pt-4 border-t border-white/10 flex justify-between">
              <a
                href={`/collections/study/${collection.id}`}
                class="px-3 py-1.5 bg-gradient-to-r from-green-500/80 to-teal-500/80 hover:from-green-500 hover:to-teal-500 text-white rounded-lg transition-colors text-sm"
              >
                Ucz się
              </a>
              <a
                href={`/collections/view/${collection.id}`}
                class="px-3 py-1.5 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-colors text-sm"
              >
                Przeglądaj
              </a>
            </div>
          </div>
        ))
      }
    </div>

    <!-- Modal potwierdzenia usunięcia -->
    <div
      id="confirmModal"
      class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50"
    >
      <div
        class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl p-6 border border-white/10 max-w-md w-full mx-4"
      >
        <h3 class="text-xl font-semibold text-white mb-4">Potwierdź usunięcie</h3>
        <p class="text-blue-100 mb-6">Czy na pewno chcesz usunąć tę kolekcję fiszek? Tej operacji nie można cofnąć.</p>
        <div class="flex justify-end space-x-3">
          <button
            id="cancelDelete"
            class="px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-colors"
          >
            Anuluj
          </button>
          <button
            id="confirmDelete"
            class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors"
          >
            Usuń
          </button>
        </div>
      </div>
    </div>
  </PageWrapper>
</Layout>

<script set:html={collectionsScript} />
